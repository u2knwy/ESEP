<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="834px" preserveAspectRatio="none" style="width:1302px;height:834px;background:#FFFFFF;" version="1.1" viewBox="0 0 1302 834" width="1302px" zoomAndPan="magnify"><defs/><g><!--MD5=[8574b24f32bb9fcb0a100948d7d93e6b]
class IEventHandler--><g id="elem_IEventHandler"><rect codeLine="1" fill="#F1F1F1" height="65.6094" id="IEventHandler" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="641" y="299.5"/><ellipse cx="687.25" cy="315.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M688.2031,312.1406 L688.2031,318.7969 L689.9219,318.7969 Q690.5313,318.7969 690.7969,319.0313 Q691.0625,319.2656 691.0625,319.6563 Q691.0625,320.0313 690.7969,320.2656 Q690.5313,320.5 689.9219,320.5 L684.7813,320.5 Q684.1719,320.5 683.9063,320.2656 Q683.6406,320.0313 683.6406,319.6406 Q683.6406,319.2656 683.9063,319.0313 Q684.1719,318.7969 684.7813,318.7969 L686.5,318.7969 L686.5,312.1406 L684.7813,312.1406 Q684.1719,312.1406 683.9063,311.9063 Q683.6406,311.6719 683.6406,311.2813 Q683.6406,310.9063 683.9063,310.6719 Q684.1719,310.4375 684.7813,310.4375 L689.9219,310.4375 Q690.5313,310.4375 690.7969,310.6719 Q691.0625,310.9063 691.0625,311.2813 Q691.0625,311.6719 690.7969,311.9063 Q690.5313,312.1406 689.9219,312.1406 L688.2031,312.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="89" x="707.75" y="321.2285">IEventHandler</text><line style="stroke:#181818;stroke-width:0.5;" x1="642" x2="830" y1="331.5" y2="331.5"/><line style="stroke:#181818;stroke-width:0.5;" x1="642" x2="830" y1="339.5" y2="339.5"/><polygon fill="#FFFF44" points="652,348.8047,656,352.8047,652,356.8047,648,352.8047" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="661" y="358.0332">handleEvent(Event event)</text></g><!--MD5=[f4dff3aa406e852e0b8341f579c1698c]
class IHeightSensor--><g id="elem_IHeightSensor"><rect codeLine="5" fill="#F1F1F1" height="181.9688" id="IHeightSensor" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="318" x="939" y="241.5"/><ellipse cx="1049.75" cy="262.8516" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1052.5156,258.7266 Q1052.6719,258.5078 1052.8594,258.3984 Q1053.0469,258.2891 1053.2656,258.2891 Q1053.6406,258.2891 1053.875,258.5547 Q1054.1094,258.8047 1054.1094,259.4141 L1054.1094,260.8672 Q1054.1094,261.4766 1053.875,261.7422 Q1053.6406,262.0078 1053.2656,262.0078 Q1052.9219,262.0078 1052.7188,261.8047 Q1052.5156,261.6172 1052.4063,261.1016 Q1052.3594,260.7422 1052.1719,260.5547 Q1051.8438,260.1797 1051.2344,259.9609 Q1050.625,259.7422 1050,259.7422 Q1049.2344,259.7422 1048.5938,260.0703 Q1047.9688,260.3984 1047.4688,261.1484 Q1046.9844,261.8984 1046.9844,262.9297 L1046.9844,264.0234 Q1046.9844,265.2578 1047.875,266.0859 Q1048.7656,266.8984 1050.3594,266.8984 Q1051.2969,266.8984 1051.9531,266.6484 Q1052.3438,266.4922 1052.7656,266.0547 Q1053.0313,265.7891 1053.1719,265.7109 Q1053.3281,265.6328 1053.5313,265.6328 Q1053.8594,265.6328 1054.1094,265.8984 Q1054.375,266.1484 1054.375,266.4922 Q1054.375,266.8359 1054.0313,267.2422 Q1053.5313,267.8203 1052.7344,268.1484 Q1051.6563,268.6016 1050.3594,268.6016 Q1048.8438,268.6016 1047.6406,267.9766 Q1046.6563,267.4766 1045.9688,266.4141 Q1045.2813,265.3359 1045.2813,264.0547 L1045.2813,262.8984 Q1045.2813,261.5703 1045.8906,260.4297 Q1046.5156,259.2734 1047.6094,258.6641 Q1048.7031,258.0391 1049.9375,258.0391 Q1050.6719,258.0391 1051.3125,258.2109 Q1051.9688,258.3672 1052.5156,258.7266 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38" x="1095.25" y="258.957">«HAL»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="1070.25" y="276.127">IHeightSensor</text><line style="stroke:#181818;stroke-width:0.5;" x1="940" x2="1256" y1="284.2031" y2="284.2031"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="947" y="295.5078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="959" y="302.7363">int adcOffset</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="947" y="313.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="959" y="320.3457">int adcIncPerMillimeter</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="947" y="330.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="959" y="337.9551">std::vector&lt;int&gt; window</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="947" y="348.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="959" y="355.5645">bool running</text><line style="stroke:#181818;stroke-width:0.5;" x1="940" x2="1256" y1="362.6406" y2="362.6406"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="947" y="373.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="292" x="959" y="381.1738">std::function&lt;void(float)&gt; onNewValueCallback</text><polygon fill="#FFFF44" points="950,389.5547,954,393.5547,950,397.5547,946,393.5547" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="959" y="398.7832">calibrateOffset(int offsetValue)</text><polygon fill="#FFFF44" points="950,407.1641,954,411.1641,950,415.1641,946,411.1641" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="959" y="416.3926">calibrateReference(int refValue)</text></g><!--MD5=[537c5cb6be412a5811209c18d6a5b6de]
class WorkpieceType--><g id="elem_WorkpieceType"><rect codeLine="15" fill="#F1F1F1" height="136.0469" id="WorkpieceType" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="250.5" y="7"/><ellipse cx="265.5" cy="23" fill="#EB937F" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M264.3594,23.7969 L264.3594,26.2969 L268.6875,26.2969 L268.6875,25.375 Q268.6875,24.7656 268.9219,24.5 Q269.1719,24.2344 269.5469,24.2344 Q269.9219,24.2344 270.1563,24.5 Q270.3906,24.7656 270.3906,25.375 L270.3906,28 L262.3906,28 Q261.7656,28 261.5,27.7656 Q261.25,27.5313 261.25,27.1406 Q261.25,26.7656 261.5156,26.5313 Q261.7813,26.2969 262.3906,26.2969 L262.6563,26.2969 L262.6563,19.6406 L262.3906,19.6406 Q261.7656,19.6406 261.5,19.4063 Q261.25,19.1719 261.25,18.7813 Q261.25,18.4063 261.5,18.1719 Q261.7656,17.9375 262.3906,17.9375 L270.0156,17.9375 L270.0156,20.5313 Q270.0156,21.1406 269.7813,21.4063 Q269.5625,21.6563 269.1719,21.6563 Q268.7969,21.6563 268.5625,21.4063 Q268.3281,21.1406 268.3281,20.5313 L268.3281,19.6406 L264.3594,19.6406 L264.3594,22.0938 L265.8438,22.0938 Q265.8438,21.4375 265.9688,21.25 Q266.2344,20.8438 266.7031,20.8438 Q267.0781,20.8438 267.3125,21.1094 Q267.5469,21.3594 267.5469,21.9688 L267.5469,23.9375 Q267.5469,24.4844 267.4219,24.6719 Q267.1563,25.0625 266.7031,25.0625 Q266.2344,25.0625 265.9688,24.6563 Q265.8438,24.4688 265.8438,23.7969 L264.3594,23.7969 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="279.5" y="28.7285">WorkpieceType</text><line style="stroke:#181818;stroke-width:0.5;" x1="251.5" x2="380.5" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="256.5" y="57.5332">WS_F</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="256.5" y="75.1426">WS_OB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="256.5" y="92.752">WS_BOM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="256.5" y="110.3613">WS_BUM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="256.5" y="127.9707">WS_UNKNOWN</text><line style="stroke:#181818;stroke-width:0.5;" x1="251.5" x2="380.5" y1="135.0469" y2="135.0469"/></g><!--MD5=[c4744ddb554f638665d5414673117e1f]
class HeightSensor--><g id="elem_HeightSensor"><rect codeLine="23" fill="#F1F1F1" height="305.2344" id="HeightSensor" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="394" x="901" y="522"/><ellipse cx="1051.25" cy="543.3516" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1054.0156,539.2266 Q1054.1719,539.0078 1054.3594,538.8984 Q1054.5469,538.7891 1054.7656,538.7891 Q1055.1406,538.7891 1055.375,539.0547 Q1055.6094,539.3047 1055.6094,539.9141 L1055.6094,541.3672 Q1055.6094,541.9766 1055.375,542.2422 Q1055.1406,542.5078 1054.7656,542.5078 Q1054.4219,542.5078 1054.2188,542.3047 Q1054.0156,542.1172 1053.9063,541.6016 Q1053.8594,541.2422 1053.6719,541.0547 Q1053.3438,540.6797 1052.7344,540.4609 Q1052.125,540.2422 1051.5,540.2422 Q1050.7344,540.2422 1050.0938,540.5703 Q1049.4688,540.8984 1048.9688,541.6484 Q1048.4844,542.3984 1048.4844,543.4297 L1048.4844,544.5234 Q1048.4844,545.7578 1049.375,546.5859 Q1050.2656,547.3984 1051.8594,547.3984 Q1052.7969,547.3984 1053.4531,547.1484 Q1053.8438,546.9922 1054.2656,546.5547 Q1054.5313,546.2891 1054.6719,546.2109 Q1054.8281,546.1328 1055.0313,546.1328 Q1055.3594,546.1328 1055.6094,546.3984 Q1055.875,546.6484 1055.875,546.9922 Q1055.875,547.3359 1055.5313,547.7422 Q1055.0313,548.3203 1054.2344,548.6484 Q1053.1563,549.1016 1051.8594,549.1016 Q1050.3438,549.1016 1049.1406,548.4766 Q1048.1563,547.9766 1047.4688,546.9141 Q1046.7813,545.8359 1046.7813,544.5547 L1046.7813,543.3984 Q1046.7813,542.0703 1047.3906,540.9297 Q1048.0156,539.7734 1049.1094,539.1641 Q1050.2031,538.5391 1051.4375,538.5391 Q1052.1719,538.5391 1052.8125,538.7109 Q1053.4688,538.8672 1054.0156,539.2266 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38" x="1095.25" y="539.457">«HAL»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="1071.75" y="556.627">HeightSensor</text><line style="stroke:#181818;stroke-width:0.5;" x1="902" x2="1294" y1="564.7031" y2="564.7031"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="576.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="921" y="583.2363">TSCADC tsc</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="593.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="921" y="600.8457">ADC* adc</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="611.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="921" y="618.4551">bool running</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="628.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="921" y="636.0645">int nMeasurements</text><line style="stroke:#181818;stroke-width:0.5;" x1="902" x2="1294" y1="643.1406" y2="643.1406"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="654.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="921" y="661.6738">addValue(int value)</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="672.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="921" y="679.2832">threadFunction()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="909" y="689.6641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="254" x="921" y="696.8926">float adcValueToMillimeter(int adcValue)</text><ellipse cx="912" cy="710.2734" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="368" x="921" y="714.502">registerOnNewValueCallback(std::function&lt;void(float)&gt; cb)</text><ellipse cx="912" cy="727.8828" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="921" y="732.1113">unregisterOnNewValueCallback()</text><ellipse cx="912" cy="745.4922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="921" y="749.7207">handleEvent(Event event)</text><ellipse cx="912" cy="763.1016" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="921" y="767.3301">start()</text><ellipse cx="912" cy="780.7109" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="921" y="784.9395">stop()</text><ellipse cx="912" cy="798.3203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="921" y="802.5488">float getAverageHeight()</text><ellipse cx="912" cy="815.9297" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="921" y="820.1582">int getLastRawValue()</text></g><!--MD5=[a1ff9136d8b9485f4314cd6a84973740]
class HeightContext--><g id="elem_HeightContext"><rect codeLine="42" fill="#F1F1F1" height="241.7031" id="HeightContext" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="405" x="460.5" y="553.5"/><ellipse cx="614.75" cy="569.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M617.5156,565.375 Q617.6719,565.1563 617.8594,565.0469 Q618.0469,564.9375 618.2656,564.9375 Q618.6406,564.9375 618.875,565.2031 Q619.1094,565.4531 619.1094,566.0625 L619.1094,567.5156 Q619.1094,568.125 618.875,568.3906 Q618.6406,568.6563 618.2656,568.6563 Q617.9219,568.6563 617.7188,568.4531 Q617.5156,568.2656 617.4063,567.75 Q617.3594,567.3906 617.1719,567.2031 Q616.8438,566.8281 616.2344,566.6094 Q615.625,566.3906 615,566.3906 Q614.2344,566.3906 613.5938,566.7188 Q612.9688,567.0469 612.4688,567.7969 Q611.9844,568.5469 611.9844,569.5781 L611.9844,570.6719 Q611.9844,571.9063 612.875,572.7344 Q613.7656,573.5469 615.3594,573.5469 Q616.2969,573.5469 616.9531,573.2969 Q617.3438,573.1406 617.7656,572.7031 Q618.0313,572.4375 618.1719,572.3594 Q618.3281,572.2813 618.5313,572.2813 Q618.8594,572.2813 619.1094,572.5469 Q619.375,572.7969 619.375,573.1406 Q619.375,573.4844 619.0313,573.8906 Q618.5313,574.4688 617.7344,574.7969 Q616.6563,575.25 615.3594,575.25 Q613.8438,575.25 612.6406,574.625 Q611.6563,574.125 610.9688,573.0625 Q610.2813,571.9844 610.2813,570.7031 L610.2813,569.5469 Q610.2813,568.2188 610.8906,567.0781 Q611.5156,565.9219 612.6094,565.3125 Q613.7031,564.6875 614.9375,564.6875 Q615.6719,564.6875 616.3125,564.8594 Q616.9688,565.0156 617.5156,565.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="635.25" y="575.2285">HeightContext</text><line style="stroke:#181818;stroke-width:0.5;" x1="461.5" x2="864.5" y1="585.5" y2="585.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="596.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="480.5" y="604.0332">HeightActions* actions</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="614.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="480.5" y="621.6426">HeightContextData* data</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="632.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="480.5" y="639.252">HeightBasestate* state</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="649.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="480.5" y="656.8613">EventManager* eventManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="667.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="480.5" y="674.4707">IHeightSensor* sensor</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="684.8516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="480.5" y="692.0801">bool running</text><line style="stroke:#181818;stroke-width:0.5;" x1="461.5" x2="864.5" y1="699.1563" y2="699.1563"/><ellipse cx="471.5" cy="713.4609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="379" x="480.5" y="717.6895">HeightContext(EventManager* mngr, IHeightSensor* sensor)</text><ellipse cx="471.5" cy="731.0703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="480.5" y="735.2988">handleEvent(Event event)</text><ellipse cx="471.5" cy="748.6797" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="209" x="480.5" y="752.9082">heightValueReceived(float value)</text><ellipse cx="471.5" cy="766.2891" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="480.5" y="770.5176">HeightResult getCurrentResult()</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="468.5" y="780.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="480.5" y="788.127">subscribeToEvents()</text></g><!--MD5=[0589eac77dcb32fd3f51a32e71289295]
class HeightActions--><g id="elem_HeightActions"><rect codeLine="56" fill="#F1F1F1" height="153.6563" id="HeightActions" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="418" x="7" y="597.5"/><ellipse cx="168.75" cy="613.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M171.5156,609.375 Q171.6719,609.1563 171.8594,609.0469 Q172.0469,608.9375 172.2656,608.9375 Q172.6406,608.9375 172.875,609.2031 Q173.1094,609.4531 173.1094,610.0625 L173.1094,611.5156 Q173.1094,612.125 172.875,612.3906 Q172.6406,612.6563 172.2656,612.6563 Q171.9219,612.6563 171.7188,612.4531 Q171.5156,612.2656 171.4063,611.75 Q171.3594,611.3906 171.1719,611.2031 Q170.8438,610.8281 170.2344,610.6094 Q169.625,610.3906 169,610.3906 Q168.2344,610.3906 167.5938,610.7188 Q166.9688,611.0469 166.4688,611.7969 Q165.9844,612.5469 165.9844,613.5781 L165.9844,614.6719 Q165.9844,615.9063 166.875,616.7344 Q167.7656,617.5469 169.3594,617.5469 Q170.2969,617.5469 170.9531,617.2969 Q171.3438,617.1406 171.7656,616.7031 Q172.0313,616.4375 172.1719,616.3594 Q172.3281,616.2813 172.5313,616.2813 Q172.8594,616.2813 173.1094,616.5469 Q173.375,616.7969 173.375,617.1406 Q173.375,617.4844 173.0313,617.8906 Q172.5313,618.4688 171.7344,618.7969 Q170.6563,619.25 169.3594,619.25 Q167.8438,619.25 166.6406,618.625 Q165.6563,618.125 164.9688,617.0625 Q164.2813,615.9844 164.2813,614.7031 L164.2813,613.5469 Q164.2813,612.2188 164.8906,611.0781 Q165.5156,609.9219 166.6094,609.3125 Q167.7031,608.6875 168.9375,608.6875 Q169.6719,608.6875 170.3125,608.8594 Q170.9688,609.0156 171.5156,609.375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="189.25" y="619.2285">HeightActions</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="424" y1="629.5" y2="629.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="640.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="27" y="648.0332">HeightContextData* data</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="658.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="27" y="665.6426">EventManager* eventManager</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="15" y="676.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="27" y="683.252">bool isMaster</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="424" y1="690.3281" y2="690.3281"/><ellipse cx="18" cy="704.6328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="392" x="27" y="708.8613">HeightActions(HeightContextData* data, EventManager* mngr)</text><ellipse cx="18" cy="722.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="27" y="726.4707">sendMotorSlowRequest(bool slow)</text><ellipse cx="18" cy="739.8516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="27" y="744.0801">sendHeightResult()</text></g><!--MD5=[ffc03f80208e028a42e98b0b94e73601]
class HeightResult--><g id="elem_HeightResult"><rect codeLine="65" fill="#F1F1F1" height="83.2188" id="HeightResult" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="9" y="291"/><ellipse cx="43.8" cy="307" fill="#F1F1F1" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M41.9094,311.5625 Q41.6906,311.8281 41.55,311.9063 Q41.4094,311.9844 41.2219,311.9844 Q40.8313,311.9844 40.5813,311.7188 Q40.3469,311.4531 40.3469,310.8594 L40.3469,309.7031 Q40.3469,309.0938 40.5813,308.8438 Q40.8313,308.5781 41.2219,308.5781 Q41.5188,308.5781 41.7219,308.7344 Q41.925,308.8906 42.0344,309.2656 Q42.1438,309.625 42.2531,309.7656 Q42.5031,310.0156 43.1125,310.2813 Q43.7219,310.5469 44.4563,310.5469 Q45.5969,310.5469 46.3156,310.0156 Q46.7844,309.6875 46.7844,309.2188 Q46.7844,308.9063 46.5656,308.625 Q46.3469,308.3438 45.8313,308.1719 Q45.5031,308.0469 44.3469,307.8281 Q42.9563,307.5625 42.2375,307.2031 Q41.5188,306.8438 41.0969,306.1875 Q40.6906,305.5156 40.6906,304.7344 Q40.6906,303.5156 41.7063,302.6094 Q42.7375,301.6875 44.3781,301.6875 Q45.0344,301.6875 45.5813,301.8281 Q46.1438,301.9688 46.6125,302.2656 Q46.9406,301.9531 47.2688,301.9531 Q47.6438,301.9531 47.8781,302.2188 Q48.1125,302.4688 48.1125,303.0781 L48.1125,304.3594 Q48.1125,304.9688 47.8781,305.2344 Q47.6438,305.4844 47.2688,305.4844 Q46.9563,305.4844 46.7219,305.2969 Q46.5344,305.1563 46.4406,304.7344 Q46.3625,304.3125 46.2219,304.125 Q45.9719,303.8125 45.4875,303.6094 Q45.0188,303.3906 44.3781,303.3906 Q43.4563,303.3906 42.925,303.8125 Q42.3938,304.2344 42.3938,304.7031 Q42.3938,305.0156 42.6125,305.3125 Q42.8313,305.6094 43.2531,305.7813 Q43.5344,305.8906 44.8313,306.1563 Q46.1438,306.4063 46.8469,306.7188 Q47.55,307.0156 48.0188,307.6719 Q48.4875,308.3281 48.4875,309.2344 Q48.4875,310.5 47.5969,311.25 Q46.4094,312.25 44.5813,312.25 Q43.8781,312.25 43.2063,312.0781 Q42.55,311.9063 41.9094,311.5625 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="62.2" y="312.7285">HeightResult</text><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="164" y1="323" y2="323"/><ellipse cx="20" cy="337.3047" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="29" y="341.5332">WorkpieceType type</text><ellipse cx="20" cy="354.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="29" y="359.1426">float averageValue</text><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="164" y1="366.2188" y2="366.2188"/></g><!--MD5=[dac448d8d8a22a0701b69cba7d9a6717]
class HeightContextData--><g id="elem_HeightContextData"><rect codeLine="70" fill="#F1F1F1" height="259.3125" id="HeightContextData" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="232" x="200" y="203"/><ellipse cx="252.75" cy="219" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M255.5156,214.875 Q255.6719,214.6563 255.8594,214.5469 Q256.0469,214.4375 256.2656,214.4375 Q256.6406,214.4375 256.875,214.7031 Q257.1094,214.9531 257.1094,215.5625 L257.1094,217.0156 Q257.1094,217.625 256.875,217.8906 Q256.6406,218.1563 256.2656,218.1563 Q255.9219,218.1563 255.7188,217.9531 Q255.5156,217.7656 255.4063,217.25 Q255.3594,216.8906 255.1719,216.7031 Q254.8438,216.3281 254.2344,216.1094 Q253.625,215.8906 253,215.8906 Q252.2344,215.8906 251.5938,216.2188 Q250.9688,216.5469 250.4688,217.2969 Q249.9844,218.0469 249.9844,219.0781 L249.9844,220.1719 Q249.9844,221.4063 250.875,222.2344 Q251.7656,223.0469 253.3594,223.0469 Q254.2969,223.0469 254.9531,222.7969 Q255.3438,222.6406 255.7656,222.2031 Q256.0313,221.9375 256.1719,221.8594 Q256.3281,221.7813 256.5313,221.7813 Q256.8594,221.7813 257.1094,222.0469 Q257.375,222.2969 257.375,222.6406 Q257.375,222.9844 257.0313,223.3906 Q256.5313,223.9688 255.7344,224.2969 Q254.6563,224.75 253.3594,224.75 Q251.8438,224.75 250.6406,224.125 Q249.6563,223.625 248.9688,222.5625 Q248.2813,221.4844 248.2813,220.2031 L248.2813,219.0469 Q248.2813,217.7188 248.8906,216.5781 Q249.5156,215.4219 250.6094,214.8125 Q251.7031,214.1875 252.9375,214.1875 Q253.6719,214.1875 254.3125,214.3594 Q254.9688,214.5156 255.5156,214.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="273.25" y="224.7285">HeightContextData</text><line style="stroke:#181818;stroke-width:0.5;" x1="201" x2="431" y1="235" y2="235"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="208" y="246.3047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="220" y="253.5332">float avgValue</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="208" y="263.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="220" y="271.1426">int nMeasurements</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="208" y="281.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206" x="220" y="288.752">std::vector&lt;float&gt; measurements</text><line style="stroke:#181818;stroke-width:0.5;" x1="201" x2="431" y1="295.8281" y2="295.8281"/><ellipse cx="211" cy="310.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="220" y="314.3613">HeightContextData()</text><ellipse cx="211" cy="327.7422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="220" y="331.9707">resetMeasurement()</text><ellipse cx="211" cy="345.3516" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="220" y="349.5801">addValue(float value)</text><ellipse cx="211" cy="362.9609" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="220" y="367.1895">float getAverageValue()</text><ellipse cx="211" cy="380.5703" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="220" y="384.7988">HeightResult getCurrentResult()</text><ellipse cx="211" cy="398.1797" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="140" x="220" y="402.4082">bool isFlat(float value)</text><ellipse cx="211" cy="415.7891" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="144" x="220" y="420.0176">bool isHigh(float value)</text><ellipse cx="211" cy="433.3984" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="144" x="220" y="437.627">bool isHole(float value)</text><ellipse cx="211" cy="451.0078" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" text-decoration="underline" textLength="173" x="220" y="455.2363">bool isUnknown(float value)</text></g><!--MD5=[596bc634e0eacd5280cf6248c1890d5d]
reverse link IHeightSensor to HeightSensor--><g id="link_IHeightSensor_HeightSensor"><path codeLine="40" d="M1098,444.04 C1098,468.83 1098,495.56 1098,521.7 " fill="none" id="IHeightSensor-backto-HeightSensor" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="1091,443.72,1098,423.72,1105,443.72,1091,443.72" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[f02c373682dc20356626d004602cc629]
link HeightResult to HeightContextData--><g id="link_HeightResult_HeightContextData"><path codeLine="85" d="M165.27,332.5 C172.36,332.5 179.44,332.5 186.53,332.5 " fill="none" id="HeightResult-to-HeightContextData" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="199.72,332.5,193.72,328.5,187.72,332.5,193.72,336.5,199.72,332.5" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[13cc49e721cf68613522393234eaa907]
link HeightActions to HeightContext--><g id="link_HeightActions_HeightContext"><path codeLine="86" d="M425.09,674.5 C432.45,674.5 439.81,674.5 447.17,674.5 " fill="none" id="HeightActions-to-HeightContext" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="460.41,674.5,454.41,670.5,448.41,674.5,454.41,678.5,460.41,674.5" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[a4360146a806e508bd918f01863b8269]
link HeightContextData to HeightContext--><g id="link_HeightContextData_HeightContext"><path codeLine="87" d="M432.03,447.19 C463.68,478.2 498.21,512.03 530.69,543.86 " fill="none" id="HeightContextData-to-HeightContext" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="540.24,553.22,538.7544,546.1636,531.6694,544.8209,533.155,551.8773,540.24,553.22" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7f9b53056a0d362c935dbb99cab0e90c]
link HeightContextData to HeightActions--><g id="link_HeightContextData_HeightActions"><path codeLine="88" d="M278.19,462.04 C266.22,502.75 253.25,546.83 242.27,584.17 " fill="none" id="HeightContextData-to-HeightActions" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="238.48,597.07,244.0067,592.438,241.8567,585.5549,236.33,590.1869,238.48,597.07" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[b2effaa81d782701017752d6b9ba627c]
link WorkpieceType to HeightContextData--><g id="link_WorkpieceType_HeightContextData"><path codeLine="89" d="M316,143.13 C316,161.46 316,181.97 316,202.51 " fill="none" id="WorkpieceType-HeightContextData" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[5c65a7c672bef714af8f8983d572df74]
reverse link HeightContext to HeightSensor--><g id="link_HeightContext_HeightSensor"><path codeLine="90" d="M878.74,674.5 C886.02,674.5 893.3,674.5 900.58,674.5 " fill="none" id="HeightContext-backto-HeightSensor" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="865.63,674.5,871.63,678.5,877.63,674.5,871.63,670.5,865.63,674.5" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[08e9e3995db48cff50c60d60dcdb7922]
reverse link IEventHandler to HeightContext--><g id="link_IEventHandler_HeightContext"><path codeLine="91" d="M724.83,385.52 C715.27,430.06 701.13,495.92 688.78,553.41 " fill="none" id="IEventHandler-backto-HeightContext" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="718.02,383.88,729.07,365.79,731.71,386.82,718.02,383.88" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[978c6422632f2bfb1be28d4d61f67e6e]
reverse link IEventHandler to HeightSensor--><g id="link_IEventHandler_HeightSensor"><path codeLine="92" d="M784.99,379.52 C824.21,416.35 881.55,470.2 936.47,521.79 " fill="none" id="IEventHandler-backto-HeightSensor" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="780.17,384.59,770.38,365.79,789.75,374.38,780.17,384.59" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[c6f919b554d9ef1d93235b8fc8cca06e]
@startuml
interface IEventHandler {
  #handleEvent(Event event)
}

class IHeightSensor << HAL >> {
  -int adcOffset
  -int adcIncPerMillimeter
  -std::function<void(float)> onNewValueCallback
  -std::vector<int> window
  -bool running
  #calibrateOffset(int offsetValue)
  #calibrateReference(int refValue)
}

enum WorkpieceType {
	WS_F
	WS_OB
	WS_BOM
	WS_BUM
	WS_UNKNOWN
}

class HeightSensor << HAL >> {
	-TSCADC tsc
	-ADC* adc
	-bool running
	-int nMeasurements
	-addValue(int value)
	-threadFunction()
	-float adcValueToMillimeter(int adcValue)
	+registerOnNewValueCallback(std::function<void(float)> cb)
	+unregisterOnNewValueCallback()
	+handleEvent(Event event)
	+start()
	+stop()
	+float getAverageHeight()
	+int getLastRawValue()
}

IHeightSensor <|.. HeightSensor

class HeightContext {
	-HeightActions* actions
	-HeightContextData* data
	-HeightBasestate* state
  -EventManager* eventManager
	-IHeightSensor* sensor
	-bool running
	+HeightContext(EventManager* mngr, IHeightSensor* sensor)
	+handleEvent(Event event)
	+heightValueReceived(float value)
	+HeightResult getCurrentResult()
	-subscribeToEvents()
}

class HeightActions {
	-HeightContextData* data
	-EventManager* eventManager
  -bool isMaster
	+HeightActions(HeightContextData* data, EventManager* mngr)
	+sendMotorSlowRequest(bool slow)
	+sendHeightResult()
}

struct HeightResult {
	+WorkpieceType type
	+float averageValue
}

class HeightContextData {
	-float avgValue
	-int nMeasurements
	-std::vector<float> measurements
  +HeightContextData()
	+resetMeasurement()
	+addValue(float value)
	+float getAverageValue()
	+HeightResult getCurrentResult()
	+{static} bool isFlat(float value)
	+{static} bool isHigh(float value)
	+{static} bool isHole(float value)
	+{static} bool isUnknown(float value)
}

HeightResult -* HeightContextData
HeightActions -o HeightContext
HeightContextData - -o HeightContext
HeightContextData - -o HeightActions
WorkpieceType .. HeightContextData
HeightContext *- HeightSensor
IEventHandler <|.. HeightContext
IEventHandler <|.. HeightSensor

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: de
Country: DE
--></g></svg>