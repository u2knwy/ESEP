<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sorting Machine: Festo Transfer System QNX-Simulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sorting Machine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Festo Transfer System QNX-Simulation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The simulation for the Festo Transfer system mimics the C-Interface to the hardware and parts of the hardware. As the user interacts with the hardware, the simulation can simulate the user interactions by pre-programmed actions or via external control.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
QNX-I/O-API</h1>
<p>The simulation provides a similar interfaces to simulated hardware of the Beagle Bone Black with QNX and the mechanical system. The behaviour of the GPIO and the interrupt system is nearly identical with the real hardware, the <a class="el" href="class_a_d_c.html">ADC</a> is reduced to a simplified system.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
GPIO-Interface</h2>
<p>Provides access to GPIO bank 0, 1, and 2 of the BeagleBone black. Depending on the need for controlling the real Festo Transfer System the following registers are simulated:</p>
<ul>
<li>OE</li>
<li>IRQSTATUS_1</li>
<li>IRQSTATUS_SET_1</li>
<li>RAISINGDETECT</li>
<li>FALLINGDETECT</li>
<li>CLEARDATAOUT</li>
<li>SETDATAOUT</li>
<li>DATAIN</li>
</ul>
<p>Hence, only raising and falling edge interrupts for interrupt line 1 are supported. (Interupt line on real hardware causes some trouble anyhow.)</p>
<p>The GPIO registers are accessed via <code>in32()</code> and <code>out32()</code>.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
ADC Support</h2>
<p>The <a class="el" href="class_a_d_c.html">ADC</a> in the simulation diviates from the BBB <a class="el" href="class_a_d_c.html">ADC</a>. The handling protocol is simplified and sampling is interlocked with the simulation cycle.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
ADC Interupt Handling</h3>
<p>The <a class="el" href="class_a_d_c.html">ADC</a> generates an IRQ with number 16 after completion of sampling.</p>
<p>To enable the <a class="el" href="class_a_d_c.html">ADC</a> interrupt on sampling complete, set the bit 1 in the register IRQ_ENABLE_SET register. To disable the IRQ, write 1 to bit 1 in the IRQ_ENABLE_CLR register. On read of the IRQ_ENABLE_SET register, the current enable status is given.</p>
<p>The status of the IRQ can be read from the IRQ_STATUS register. Bit 1 is set if IRQ has been raised. To clear the IRQ-flag, write 1 to bit 1 in the IRQ_STATUS register, otherwise no new sampling can be started.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Sampling</h3>
<p>The <a class="el" href="class_a_d_c.html">ADC</a> is preconfigured, except the IRQ handling. To enable the sampling of one vaule, IRQ handling has to be configured, no pending interrupt and the bit 0 in CTRL register has to be set (auto-cleared). The sampled value is then provided in the DATA register. The IRQ is issued on sampling completion. The DATA register is only updated on IRQ, hence IRQ handling must be configured.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
ADC Registers</h3>
<p><a class="el" href="class_a_d_c.html">ADC</a> registers are located form base address 0x44E0D000 on. The register set has a range of 0x00002000.</p>
<div class="fragment"><div class="line">(rw) IRQ_ENABLE_SET 0x2c</div>
<div class="line">(wo) IRQ_ENABLE_CLR 0x30</div>
<div class="line">(rw) IRQ_STATUS 0x28</div>
<div class="line">(rw) CTRL 0x40</div>
<div class="line">(ro) DATA 0x100</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Interrupt Handling</h2>
<p>In the current release, only the sending of pulse messages on interrupt by means of InterruptAttachEvent and the sending of pulse messages as the result of an ISR is supported.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
QNX Simulation API</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Acces to simulated Time</h2>
<p>The simulation is started via a singleton of type <code><a class="el" href="class_simulation_starter_q_n_x.html">SimulationStarterQNX</a></code> that is accessible via the global variable <code>simulationStarter</code>. Hence, only one instance of the simulation exists. Via the singleton, the simulation can be querried for the current simulation time in milliseconds by the method <code>currentSimTime()</code>.</p>
<p>Example for displaying current simulation time:</p>
<div class="fragment"><div class="line">std::cout &lt;&lt; simulationStarter-&gt;currentSimTime() &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>With the macro <code>SIM_SHOW_TIMESTAMP</code> is defined, the time stamp of the simulation is printed in each simulation cycle.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Manual Start</h2>
<p>The simulation can be configured to wait for an internal or external start command.</p>
<p>For internal start via C/C++ function call, the signleton <code>simulationStarter</code> provides a method <code>startSimulation()</code> to start the simulation on demand.</p>
<p>Example:</p>
<div class="fragment"><div class="line">simulationStarter-&gt;startSimulation();</div>
</div><!-- fragment --><p>To enable this feature, the macro <code>SIM_MANUAL_START</code> has to be defined globally. This feature cannot be combined with a configuration for system B of a Twin-system.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Header Files</h2>
<p>All simulation sources have to be inlcuded into the QNX-project. The simulation core runs independend from other parts of the programm. Access to the simulated hardware is provided by redirection of QNX-functions for GPIO-access, ADC-access and interrupt services.</p>
<p>To use the redirection, dedicated include files from the simulation package have to be included into the source-files (.cpp) <em><b>as last include</b></em>!</p>
<p>The following functions are replaced by the simulation with the header file <code><a class="el" href="simqnxirqapi_8h_source.html">simqnxirqapi.h</a></code>:</p>
<ul>
<li>InterruptAttach</li>
<li>InterruptAttachEvent</li>
<li>InterruptMask</li>
<li>InterruptUnmask</li>
<li>InterruptDetach</li>
</ul>
<p>InterruptMask and InterruptUnmask are in comparison to the QNX documetation not recursive!</p>
<p>The following functions are replaced by the simulation with the header file <code><a class="el" href="simqnxgpioapi_8h_source.html">simqnxgpioapi.h</a></code>:</p>
<ul>
<li>out32</li>
<li>in32</li>
<li>mmap_device_io</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Settings / Makefile</h2>
<p>For compilation, the include-pathes have to be set to each directory in the Makefile. The pathes are either copys from the repository or logical links (Mac/Linux) to the repository (use the later), so the names used here may need adaptation.</p>
<div class="fragment"><div class="line">INCLUDES += -Isrc/simulationbase</div>
<div class="line">INCLUDES += -Isrc/simulationadapterqnx</div>
<div class="line">INCLUDES += -Isrc/simulationudpqnx</div>
<div class="line">INCLUDES += -Isrc/simulationcore</div>
</div><!-- fragment --><p>If the sources of the folder <code>simudp</code> are added in the project, the library socket has to be added to the list of libraries for linking in the Make-file. Look for the two lines shown and and add the third.</p>
<div class="fragment"><div class="line">#LIBS += -L/path/to/my/lib/$(PLATFORM)/usr/lib -lmylib</div>
<div class="line">#LIBS += -L../mylib/$(OUTPUT_DIR) -lmylib</div>
<div class="line">LIBS += -lsocket</div>
</div><!-- fragment --><p>For information on additional settings (Macros) to enable/disable additional features in the simulation, see other documentation.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Simulation Time</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Time Resolution</h2>
<p>The simulation cylce is set to 20 ms.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Predefined Actions</h1>
<p>The simulation starts automaticically if not otherwise configured. The following actions are preprogrammed, but commented out:</p>
<ul>
<li>pressing and release of start-button two times.</li>
<li>adding and removing of an item two times.</li>
</ul>
<p>For more information on preprogramming of actions, see other documentaion. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
